---
title: "stages.lua"
description: "Documenta√ß√£o t√©cnica de stages.lua"
icon: "file-code"
---

## üõ†Ô∏è Informa√ß√µes do Arquivo

Este arquivo define as tabelas de configura√ß√£o para os "stages" (est√°gios) de experi√™ncia, skills e magic level. Ele √© fundamental para o balanceamento da progress√£o dos jogadores no servidor, determinando qu√£o r√°pido eles avan√ßam em diferentes faixas de n√≠vel.

<ResponseField name="Caminho Original" type="path">
  `server/data/stages.lua`
</ResponseField>

<Tip>
  As altera√ß√µes neste arquivo afetam diretamente a economia e a longevidade do servidor. Ajustes devem ser feitos com cautela para evitar desbalanceamento.
</Tip>

## üìÑ Vis√£o Geral do C√≥digo

### Resumo Executivo

O `stages.lua` cont√©m tabelas globais que o motor do servidor utiliza para calcular os multiplicadores de ganho de experi√™ncia e habilidades. Ele permite criar uma curva de dificuldade progressiva, onde o ganho diminui √† medida que o jogador fica mais forte.

### Fluxo de Execu√ß√£o

Este arquivo √© carregado durante a inicializa√ß√£o pelo `core.lua`. As tabelas definidas aqui tornam-se globais e s√£o consultadas internamente pelo motor C++ (Source) toda vez que um jogador ganha experi√™ncia ou treina uma habilidade.

```mermaid
graph LR
    A[core.lua] -->|dofile| B[stages.lua]
    B -.->|Define| C[experienceStages]
    B -.->|Define| D[skillsStages]
    B -.->|Define| E[magicLevelStages]
    F[Engine C++] -.->|L√™| C
    F -.->|L√™| D
    F -.->|L√™| E
```

### An√°lise das Tabelas de Configura√ß√£o

Este arquivo n√£o cont√©m fun√ß√µes execut√°veis, mas sim defini√ß√µes de dados estruturados em tabelas Lua.

#### 1. experienceStages

Define a curva de experi√™ncia do servidor.

- **Estrutura**: Lista de objetos contendo `minlevel`, `maxlevel` (opcional) e `multiplier`.
- **L√≥gica**: O servidor verifica o n√≠vel atual do jogador, encontra a faixa correspondente e aplica o multiplicador sobre a experi√™ncia base do monstro.
- **Comportamento**: Se `maxlevel` n√£o for definido, a faixa √© considerada infinita (at√© o pr√≥ximo stage ou para sempre).

#### 2. skillsStages

Define os multiplicadores para habilidades de combate f√≠sico (Fist, Club, Sword, Axe, Distance, Shielding).

- **Estrutura**: Similar a experienceStages.
- **Prop√≥sito**: Acelerar o treino em n√≠veis baixos de skill e desacelerar em n√≠veis altos para manter a competitividade.

#### 3. magicLevelStages

Define os multiplicadores para o Magic Level (Mana gasta).

- **Estrutura**: Similar a experienceStages.
- **Prop√≥sito**: Balancear a progress√£o de magos e o impacto do uso de mana/runas.

### Exemplo de Uso

Embora seja um arquivo de configura√ß√£o, voc√™ pode acessar essas tabelas em scripts Lua para criar comandos personalizados, como um comando `!rates` para o jogador ver seus rates atuais.

```lua
-- Exemplo: Verificando o multiplicador atual de um jogador
local playerLevel = player:getLevel()
local currentRate = 1

for _, stage in pairs(experienceStages) do
    if playerLevel >= stage.minlevel and (not stage.maxlevel or playerLevel <= stage.maxlevel) then
        currentRate = stage.multiplier
        break
    end
end

player:sendTextMessage(MESSAGE_STATUS_CONSOLE_BLUE, "Seu rate de experi√™ncia atual √©: " .. currentRate .. "x")
```

### Observa√ß√µes T√©cnicas

- **Depend√™ncia do Motor**: O nome das vari√°veis (`experienceStages`, `skillsStages`, `magicLevelStages`) √© hardcoded no c√≥digo fonte (C++) do servidor. N√£o renomeie estas tabelas.
- **Ordena√ß√£o**: √â recomendado manter as tabelas ordenadas do menor n√≠vel para o maior para facilitar a leitura e manuten√ß√£o.
- **Sobreposi√ß√£o**: Evite faixas de n√≠veis sobrepostas (ex: 1-100 e 50-150), pois isso pode causar comportamento imprevis√≠vel na sele√ß√£o do multiplicador.

### Alertas

- ‚ö†Ô∏è **Sintaxe Lua**: Certifique-se de que todas as chaves e v√≠rgulas estejam corretas. Um erro de sintaxe aqui impedir√° o servidor de iniciar.
- ‚ö†Ô∏è **Stages Vazios**: Se a tabela for deixada vazia ou comentada, o servidor pode assumir rate 1x padr√£o ou apresentar erros no console.
- ‚ö†Ô∏è **Max Level**: Lembre-se que o √∫ltimo est√°gio geralmente n√£o deve ter `maxlevel` definido, para garantir que jogadores de n√≠vel muito alto continuem recebendo experi√™ncia (mesmo que reduzida).