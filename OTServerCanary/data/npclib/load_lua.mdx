---
title: "load.lua"
description: "Documenta√ß√£o t√©cnica de load.lua"
icon: "file-code"
---

## üõ†Ô∏è Informa√ß√µes do Arquivo

Este arquivo √© o carregador principal da biblioteca de NPCs (Non-Player Characters). Ele √© respons√°vel por inicializar o sistema de "NpcHandler", que gerencia estados de conversa, com√©rcio e intera√ß√µes complexas entre jogadores e NPCs.

<ResponseField name="Caminho Original" type="path">
  `server/data/npclib/load.lua`
</ResponseField>

<Tip>
  Este sistema √© a base para a maioria dos scripts de NPC estilo "Tibia Global" (baseado no sistema Jiddo), permitindo intera√ß√µes complexas sem reescrever c√≥digo b√°sico para cada NPC.
</Tip>

## üìÑ Vis√£o Geral do C√≥digo

### Resumo Executivo

O `load.lua` orquestra a inclus√£o dos componentes do sistema de NPCs. Ele carrega desde extens√µes b√°sicas da classe `Npc` at√© m√≥dulos avan√ßados de com√©rcio e banco, garantindo que a API `NpcHandler` esteja dispon√≠vel para os scripts individuais de cada NPC.

### Fluxo de Execu√ß√£o

Este arquivo √© executado durante a inicializa√ß√£o do servidor (geralmente chamado pelo `libs.lua` ou `core.lua`).

```mermaid
graph TD
    A[load.lua] -->|dofile| B[npc.lua]
    A -->|dofile| C[npc_system/npc_handler.lua]
    A -->|dofile| D[npc_system/keyword_handler.lua]
    A -->|dofile| E[npc_system/modules.lua]
    A -->|dofile| F[npc_system/custom_modules.lua]
    A -->|dofile| G[npc_system/bank_system.lua]
    
    C -.->|Gerencia| H["Estados de Conversa"]
    D -.->|Processa| I["Palavras-chave (hi, trade)"]
    E -.->|Fornece| J["Shop / Travel"]
```

### An√°lise dos M√≥dulos Carregados

1. **`Extens√µes B√°sicas (npc.lua)`**:
   - Adiciona m√©todos auxiliares √† classe `Npc` e fun√ß√µes globais como `MsgContains` e `MsgFind`.
2. **`Core do Sistema (npc_system/npc_handler.lua)`**:
   - Define a classe `NpcHandler`, que gerencia o foco (quem o NPC est√° atendendo), filas de mensagens e eventos de `onCreatureSay`.
3. **`Processador de Texto (npc_system/keyword_handler.lua)`**:
   - L√≥gica para detectar palavras-chave em frases complexas e navegar na √°rvore de di√°logo.
4. **`M√≥dulos Padr√£o (npc_system/modules.lua)`**:
   - Implementa√ß√µes prontas para lojas (`ShopModule`), viagens (`TravelModule`) e outros comportamentos comuns.
5. **Sistemas Espec√≠ficos**:
   - `custom_modules.lua`: Ganchos para m√≥dulos criados pelo usu√°rio.
   - `bank_system.lua`: L√≥gica dedicada para NPCs banqueiros (balance, deposit, withdraw).

### Exemplo de Uso

Este arquivo raramente precisa ser editado, a menos que voc√™ esteja instalando um novo m√≥dulo de NPC (ex: um sistema de crafting via NPC).

```lua
-- Exemplo: Adicionando um m√≥dulo de miss√µes (quests) customizado
dofile(CORE_DIRECTORY .. "/npclib/npc_system/quest_module.lua")
```

### Observa√ß√µes T√©cnicas

- **Legado**: Este sistema √© uma evolu√ß√£o do antigo sistema de NPCs do Jiddo, amplamente usado em servidores Open Tibia para simular o comportamento do Tibia real.
- **`Vari√°vel CORE_DIRECTORY`**: Assim como outros carregadores, depende desta global para caminhos absolutos.
- **Fun√ß√µes Globais**: O arquivo `npc.lua` carregado aqui define fun√ß√µes globais importantes como `MsgContains`, usadas em quase todos os scripts de NPC.

### Alertas

- ‚ö†Ô∏è **Ordem de Carregamento**: `npc_handler.lua` deve ser carregado antes dos m√≥dulos, pois os m√≥dulos herdam ou utilizam a estrutura do handler.
- ‚ö†Ô∏è **Depend√™ncias**: Scripts de NPC individuais (`data/npc/scripts/*.lua`) dependem estritamente que este arquivo tenha sido carregado com sucesso. Se falhar, os NPCs n√£o responder√£o a "hi".